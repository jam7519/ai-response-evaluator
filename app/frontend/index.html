<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Response Evaluator</title>
  <style>
    body {
      margin: 0;
      padding: 24px;
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #0b1220;
      color: #e6e6e6;
    }

    .card {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 18px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    h1 { margin: 0 0 12px; font-size: 26px; }
    label { display:block; margin: 12px 0 6px; font-size: 14px; opacity: 0.9; }

    textarea, input, select {
      width: 100%;
      box-sizing: border-box;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.25);
      color: #e6e6e6;
      outline: none;
    }

    textarea { min-height: 90px; resize: vertical; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 10px;
    }

    .btn {
      margin-top: 12px;
      background: #2ecc71;
      color: #0b1220;
      border: 0;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
    }

    .muted { opacity: 0.8; font-size: 13px; }

    .history {
      margin-top: 18px;
      display: grid;
      gap: 12px;
    }

    .item {
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      border-radius: 14px;
      padding: 12px;
    }

    .item h3 { margin: 0 0 8px; font-size: 16px; }
    .pill {
      display:inline-block;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.18);
      margin-right: 6px;
      font-size: 12px;
      opacity: 0.95;
    }

    pre {
      white-space: pre-wrap;
      background: rgba(255,255,255,0.05);
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.12);
      margin: 8px 0 0;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>AI Response Evaluator</h1>
    <div class="muted">Ask a question, then score the response. Saved results show below.</div>

    <label for="question">Question</label>
    <textarea id="question" placeholder="Ask something..."></textarea>

    <div class="row">
      <div>
        <label for="correctness">Correctness (1–5)</label>
        <select id="correctness">
          <option value="5">5 (Excellent)</option>
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="1">1 (Bad)</option>
        </select>
      </div>
      <div>
        <label for="clarity">Clarity (1–5)</label>
        <select id="clarity">
          <option value="5">5 (Very clear)</option>
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="1">1 (Confusing)</option>
        </select>
      </div>
      <div>
        <label for="hallucination">Hallucination?</label>
        <select id="hallucination">
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>
      </div>
    </div>

    <label for="notes">Notes (optional)</label>
    <input id="notes" placeholder="What was good/bad about it?" />

    <button class="btn" id="submitBtn">Ask + Save Evaluation</button>

    <div class="history" id="history"></div>
  </div>

  <script>
    const API_BASE = "http://127.0.0.1:8000";

    const questionEl = document.getElementById("question");
    const correctnessEl = document.getElementById("correctness");
    const clarityEl = document.getElementById("clarity");
    const hallucinationEl = document.getElementById("hallucination");
    const notesEl = document.getElementById("notes");
    const submitBtn = document.getElementById("submitBtn");
    const historyEl = document.getElementById("history");

    function itemHTML(r) {
      return `
        <div class="item">
          <h3>#${r.id} <span class="muted">(${r.created_at})</span></h3>
          <div>
            <span class="pill">Correctness: ${r.correctness}/5</span>
            <span class="pill">Clarity: ${r.clarity}/5</span>
            <span class="pill">Hallucination: ${r.hallucination ? "YES" : "NO"}</span>
          </div>
          <div class="muted" style="margin-top:8px;"><b>Q:</b> ${escapeHtml(r.question)}</div>
          <pre><b>A:</b> ${escapeHtml(r.answer)}</pre>
          ${r.notes ? `<div class="muted" style="margin-top:8px;"><b>Notes:</b> ${escapeHtml(r.notes)}</div>` : ""}
        </div>
      `;
    }

    function escapeHtml(s) {
      return (s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    async function loadHistory() {
      const res = await fetch(`${API_BASE}/evaluations`);
      const data = await res.json();
      historyEl.innerHTML = data.length
        ? data.map(itemHTML).join("")
        : `<div class="muted">No evaluations yet. Submit one above.</div>`;
    }

    submitBtn.addEventListener("click", async () => {
      const question = questionEl.value.trim();
      if (!question) return alert("Type a question first.");

      submitBtn.disabled = true;
      submitBtn.textContent = "Saving...";

      try {
        const payload = {
          question,
          correctness: Number(correctnessEl.value),
          clarity: Number(clarityEl.value),
          hallucination: hallucinationEl.value === "true",
          notes: notesEl.value.trim()
        };

        await fetch(`${API_BASE}/ask`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        questionEl.value = "";
        notesEl.value = "";
        await loadHistory();
      } catch (e) {
        alert("Error calling API. Is FastAPI running on 127.0.0.1:8000 ?");
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Ask + Save Evaluation";
      }
    });

    loadHistory();
  </script>
</body>
</html>

